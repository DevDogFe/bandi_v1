<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bandi.novel.repository.BoardRepository">

	<insert id="insert">
		insert into board_tb(user_id , title, board_type_id,
		category_id, content)
		values(#{userId}, #{title}, #{boardTypeId},
		#{categoryId},
		#{content});
	</insert>

	<select id="selectBoardType"
		resultType="com.bandi.novel.dto.BoardTypeDto">
		select * from board_type_tb;
	</select>

	<select id="selectBoardListByBoardTypeId"
		resultType="com.bandi.novel.dto.BoardDto">
		select b.id, b.title, b.user_id, u.username, b.created_at,
		b.category_id, b.views, bc.category_name as category_name,
		bt.board_name as board_name
		from
		board_tb as b
		left join user_tb as u
		on
		b.user_id = u.id
		left join board_type_tb as bt
		on b.board_type_id =
		bt.id
		left join board_category_tb as bc
		on b.category_id = bc.id
		where
		b.board_type_id = #{boardTypeId}
	</select>

	<select id="selectBoardListByCategoryId"
		resultType="com.bandi.novel.dto.BoardDto">
		select b.id, b.title, b.user_id, u.username, b.created_at,
		b.category_id, b.views, bc.category_name as category_name,
		bt.board_name as board_name
		from
		board_tb as b
		left join user_tb as u
		on
		b.user_id = u.id
		left join board_type_tb as bt
		on b.board_type_id =
		bt.id
		left join board_category_tb as bc
		on b.category_id = bc.id
		where
		b.category_id = #{categoryId}
	</select>

	<select id="selectBoardDetailById"
		resultType="com.bandi.novel.dto.BoardDetailDto">
		select *
		from board_tb as b
		left join user_tb as u
		on
		b.user_id = u.id
		left join board_category_tb as bc
		on b.category_id =
		bc.id
		where b.id = #{id}
	</select>

	<update id="updateBoard">
		update board_tb set title = #{title}, content =
		#{content} where id = #{id}
	</update>

	<delete id="deleteById">
		delete from board_tb where id = #{id}
	</delete>

	<update id="updateViewById">
		update board_tb
		set views = views + 1
		where id = #{id}
	</update>

	<select id="selectSearchList" resultType="com.bandi.novel.dto.BoardDto">
		select b.id, b.title, b.user_id, u.username, b.created_at,
		b.category_id, b.views, bc.category_name as category_name,
		bt.board_name as board_name
		from
		board_tb as b
		left join user_tb as u
		on
		b.user_id = u.id
		left join board_type_tb as bt
		on b.board_type_id =
		bt.id
		left join board_category_tb as bc
		on b.category_id = bc.id
		where
		b.board_type_id = #{boardTypeId} 
		and #{type} like concat('%', #{keyword}, '%') 
	</select>

</mapper>